package com.java.gzip;

import com.google.common.collect.Lists;
import org.apache.commons.collections.CollectionUtils;

import java.io.ByteArrayOutputStream;
import java.net.URLEncoder;
import java.util.Arrays;
import java.util.Base64;
import java.util.List;
import java.util.zip.GZIPOutputStream;

/**
 * Author: Boris
 * Date: 2018/11/19 14:32

 * Description:
 */
public class GzipTest {

    public static void main(String[] args) throws Exception{

        Object[] array = {37, 1, 2, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0.5, 1, 2, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0.5, 1, 2, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0.5, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.9, 0.9, 0.9, 0.9, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.9, 0.9, 0.9, 0.9, 1, 0, 0, 0, 9999999, 2, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0.5, 1, 2, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0.5, 1, 2, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0.5, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.9, 0.9, 0.9, 0.9, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.9, 0.9, 0.9, 0.9, 1, 2, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0.5, 1, 2, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0.5, 1, 2, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0.5, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.9, 0.9, 0.9, 0.9, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.9, 0.9, 0.9, 0.9, 1, 2, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0.5, 1, 2, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0.5, 1, 2, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0.5, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.9, 0.9, 0.9, 0.9, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.9, 0.9, 0.9, 0.9, 1, 12224, 5182, 5663, 4973, 803, 793, 4033, 3388, 4721, 4060, 0.141798, 0.159461, 0.854268, 0.834483, 0.329925, 0.653802, 8672, 3614, 4086, 3548, 569, 559, 2876, 2379, 3378, 2869, 0.139256, 0.157554, 0.851391, 0.829209, 0.331642, 0.658273, 3566, 1531, 1859, 1589, 277, 269, 1224, 983, 1443, 1200, 0.149005, 0.169289, 0.848233, 0.819167, 0.343242, 0.642064, 1426, 628, 882, 747, 125, 118, 511, 404, 618, 509, 0.141723, 0.157965, 0.826861, 0.793713, 0.358345, 0.643312, 163, 132, 343, 290, 41, 38, 150, 119, 163, 132, 0.119534, 0.131034, 0.920245, 0.901515, 0.920245, 0.901515, 4662397, 2046885, 2255374, 1961905, 282219, 275443, 1646042, 1373726, 1914532, 1634339, 0.125132, 0.140396, 0.859762, 0.840539, 0.353046, 0.67113, 2505336, 1081294, 1253585, 1083461, 163308, 158210, 888511, 731057, 1029729, 871161, 0.130273, 0.146023, 0.862859, 0.839176, 0.354647, 0.676095, 1006487, 441207, 574085, 490778, 74919, 71162, 382292, 309647, 438633, 365538, 0.130502, 0.144998, 0.871553, 0.847099, 0.379828, 0.701818, 419925, 194228, 302927, 256672, 38371, 35482, 182013, 145233, 204025, 167113, 0.126667, 0.138239, 0.892111, 0.869071, 0.433442, 0.747745, 69570, 55580, 146794, 125051, 16697, 15398, 66477, 52492, 69570, 55580, 0.113744, 0.123134, 0.955541, 0.94444, 0.955541, 0.94444, 5956114, 2606088, 2841136, 2494879, 359084, 351131, 2055576, 1734682, 2406203, 2075642, 0.126387, 0.140741, 0.854282, 0.835733, 0.34512, 0.665627, 3179735, 1377107, 1576267, 1379291, 207036, 201143, 1102005, 920085, 1290987, 1107603, 0.131346, 0.145831, 0.853614, 0.830699, 0.346571, 0.668129, 1285737, 564656, 724977, 628627, 95958, 91619, 476045, 392333, 550796, 466481, 0.13236, 0.145745, 0.864286, 0.841048, 0.370251, 0.694818, 533566, 248119, 382634, 329211, 49216, 45899, 226030, 183795, 255200, 212789, 0.128624, 0.139421, 0.885697, 0.863743, 0.423621, 0.740753, 84429, 68648, 183903, 158929, 21262, 19763, 80495, 64719, 84429, 68648, 0.115615, 0.124351, 0.953405, 0.942766, 0.953405, 0.942766, 2.4209476E7, 1.0081575E7, 1.0744002E7, 9613696, 1367642, 1341878, 7503935, 6462611, 9067110, 7990519, 0.127294, 0.13958, 0.827599, 0.808785, 0.309959, 0.641032, 1.2852785E7, 5320154, 5942064, 5318548, 781081, 762171, 4003078, 3433740, 4844626, 4267834, 0.131449, 0.143304, 0.826292, 0.804563, 0.311456, 0.645421, 5273705, 2173493, 2739365, 2426786, 369922, 355597, 1723685, 1456692, 2053218, 1782747, 0.135039, 0.14653, 0.839504, 0.817105, 0.326845, 0.670208, 2135500, 961141, 1452706, 1284456, 194027, 183177, 812347, 683657, 942480, 812855, 0.133562, 0.142611, 0.861925, 0.841057, 0.380401, 0.711297, 268345, 223749, 664915, 587891, 80387, 75732, 257973, 213412, 268343, 223747, 0.120898, 0.12882, 0.961355, 0.953809, 0.961348, 0.953801};
        Object[] array1 = {49, 1, 34, 31, 27, 27, 0, 0, 27, 27, 27, 27, 0, 0, 1, 1, 0.794118, 0.870968, 22, 20, 18, 18, 0, 0, 18, 18, 18, 18, 0, 0, 1, 1, 0.818182, 0.9, 4, 2, 2, 2, 0, 0, 2, 2, 2, 2, 0, 0, 1, 1, 0.5, 1, 3, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0.333333, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.9, 0.9, 0.9, 0.9, 1, 1, 1, 1, 35, 34, 31, 27, 27, 0, 0, 27, 27, 27, 27, 0, 0, 1, 1, 0.794118, 0.870968, 22, 20, 18, 18, 0, 0, 18, 18, 18, 18, 0, 0, 1, 1, 0.818182, 0.9, 4, 2, 2, 2, 0, 0, 2, 2, 2, 2, 0, 0, 1, 1, 0.5, 1, 3, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0.333333, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.9, 0.9, 0.9, 0.9, 1, 10, 8, 8, 8, 0, 0, 8, 8, 8, 8, 0, 0, 1, 1, 0.8, 1, 10, 8, 8, 8, 0, 0, 8, 8, 8, 8, 0, 0, 1, 1, 0.8, 1, 3, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0.333333, 1, 3, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0.333333, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.9, 0.9, 0.9, 0.9, 1, 3, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0.333333, 1, 3, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0.333333, 1, 3, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0.333333, 1, 3, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0.333333, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.9, 0.9, 0.9, 0.9, 1, 470, 173, 258, 214, 31, 26, 152, 125, 176, 149, 0.120155, 0.121495, 0.863636, 0.838926, 0.323404, 0.722543, 470, 173, 258, 214, 31, 26, 152, 125, 176, 149, 0.120155, 0.121495, 0.863636, 0.838926, 0.323404, 0.722543, 470, 173, 258, 214, 31, 26, 152, 125, 176, 149, 0.120155, 0.121495, 0.863636, 0.838926, 0.323404, 0.722543, 292, 106, 192, 150, 28, 23, 101, 76, 113, 88, 0.145833, 0.153333, 0.893805, 0.863636, 0.34589, 0.716981, 56, 38, 123, 88, 16, 11, 56, 38, 56, 38, 0.130081, 0.125, 1, 1, 1, 1, 122555, 52269, 74316, 62220, 9495, 8563, 46903, 37134, 53754, 43934, 0.127765, 0.137625, 0.872549, 0.845222, 0.38271, 0.71044, 122555, 52269, 74316, 62220, 9495, 8563, 46903, 37134, 53754, 43934, 0.127765, 0.137625, 0.872549, 0.845222, 0.38271, 0.71044, 122555, 52269, 74316, 62220, 9495, 8563, 46903, 37134, 53754, 43934, 0.127765, 0.137625, 0.872549, 0.845222, 0.38271, 0.71044, 72196, 31844, 51560, 42937, 6695, 5869, 29964, 23537, 33799, 27345, 0.129849, 0.136689, 0.886535, 0.860742, 0.415037, 0.739135, 10826, 8250, 24978, 20575, 3086, 2602, 10471, 7895, 10826, 8250, 0.123549, 0.126464, 0.967209, 0.95697, 0.967209, 0.95697, 506986, 227266, 319898, 270449, 39271, 36464, 204938, 164632, 232224, 191548, 0.122761, 0.134828, 0.882501, 0.859482, 0.404228, 0.724402, 506986, 227266, 319898, 270449, 39271, 36464, 204938, 164632, 232224, 191548, 0.122761, 0.134828, 0.882501, 0.859482, 0.404228, 0.724402, 506986, 227266, 319898, 270449, 39271, 36464, 204938, 164632, 232224, 191548, 0.122761, 0.134828, 0.882501, 0.859482, 0.404228, 0.724402, 293572, 134872, 217051, 182837, 27338, 24979, 126255, 100578, 141315, 115425, 0.125952, 0.136619, 0.89343, 0.871371, 0.430065, 0.745729, 42011, 32889, 102066, 85838, 11659, 10518, 41025, 31910, 42011, 32889, 0.11423, 0.122533, 0.97653, 0.970233, 0.97653, 0.970233, 2.4209476E7, 1.0081575E7, 1.0744002E7, 9613696, 1367642, 1341878, 7503935, 6462611, 9067110, 7990519, 0.127294, 0.13958, 0.827599, 0.808785, 0.309959, 0.641032, 1.2852785E7, 5320154, 5942064, 5318548, 781081, 762171, 4003078, 3433740, 4844626, 4267834, 0.131449, 0.143304, 0.826292, 0.804563, 0.311456, 0.645421, 5273705, 2173493, 2739365, 2426786, 369922, 355597, 1723685, 1456692, 2053218, 1782747, 0.135039, 0.14653, 0.839504, 0.817105, 0.326845, 0.670208, 2135500, 961141, 1452706, 1284456, 194027, 183177, 812347, 683657, 942480, 812855, 0.133562, 0.142611, 0.861925, 0.841057, 0.380401, 0.711297, 268345, 223749, 664915, 587891, 80387, 75732, 257973, 213412, 268343, 223747, 0.120898, 0.12882, 0.961355, 0.953809, 0.961348, 0.953801};
        List<Object> list = Arrays.asList(array1);
        long start = System.currentTimeMillis();
        byte[] gzipArray = gzipCompress(list);
        String base64str = Base64.getEncoder().encodeToString(gzipArray);
        String urlEncoder = URLEncoder.encode( base64str, "UTF-8" );
        System.out.println(System.currentTimeMillis()-start + "毫秒");
        System.out.println(urlEncoder);
    }

    /**
     * 压缩特征值
     * @param featureValueList
     * @return
     * @throws Exception
     */
    private static byte[] gzipCompress(List<Object> featureValueList)throws Exception {
        if (CollectionUtils.isEmpty(featureValueList)) {
            return new byte[0];
        }
        ByteArrayOutputStream out = new ByteArrayOutputStream();
        GZIPOutputStream gzip = new GZIPOutputStream(out);
        byte[] resultByteArray;
        try {
            gzip.write(featureValueList.toString().getBytes("utf-8"));
            gzip.finish();
            resultByteArray =  out.toByteArray();
            return resultByteArray;
        }finally {
            if (gzip != null) {
                gzip.close();
            }
            if (out != null) {
                out.close();
            }
        }
    }
}
